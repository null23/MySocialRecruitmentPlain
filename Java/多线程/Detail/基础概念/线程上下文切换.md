#### 什么是上下文切换？
    1.单核处理器也可以支持多线程执行代码，CPU通过给每个线程分配CPU时间片(时间片分配算法)来实现这个机制。时间片是CPU分配给各个线程的时间，因为时间片非常短，所以CPU通过不停的切换线程执行，让我们感觉多个线程是同时执行的。

    2.上下文切换中的"上下文"，目前理解为：一个线程在CPU中的状态。
    如果要进行正在执行的几个线程的切换，也就是上下文的切换，我们需要记录并恢复各种正在运行的线程的状态，使它能够完成切换操作。
    在上下文切换过程中，CPU会停止处理当前运行的程序，并保存当前程序运行的具体位置以便之后继续运行。

#### 如何触发上下文切换？
    1.中断处理：在中断处理中，其他程序"打断"了当前正在运行的程序。当CPU接收到中断请求时，会在正在运行的程序和发起中断请求的程序之间进行一次上下文切换。中断分为硬件中断和软件中断，软件中断包括因为IO阻塞、未抢到资源或者用户代码等原因，线程被挂起。
    在Java中，比如synchorized同步互斥，或者调用wait，sleep等方法，线程的阻塞会导致上下文的切换。

    2.多任务处理：在多任务处理中，CPU会在不同程序之间来回切换，每个程序都有相应的处理时间片，CPU在两个时间片的间隔中进行上下文切换。

    3.用户态切换：对于一些操作系统，当进行用户态切换时也会进行一次上下文切换，虽然这不是必须的。

#### 如何减少上下文切换？
    1.无锁并发：多线程竞争时，会引起上下文切换，所以多线程处理数据时，可以用一些办法来避免使用锁，如将数据的ID按照Hash取模分段，不同的线程处理不同段的数据；

    2.CAS算法：Java的Atomic包使用CAS算法来更新数据，而不需要加锁；

    3.最少线程：避免创建不需要的线程，比如任务很少，但是创建了很多线程来处理，这样会造成大量线程都处于等待状态；

    4.使用协程：在单线程里实现多任务的调度，并在单线程里维持多个任务间的切换；



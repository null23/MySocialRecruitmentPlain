虚拟机栈和本地方法栈
    虚拟机栈：
        1.虚拟机栈是线程隔离的，服务于Java线程，也就是一个线程对应一个虚拟机栈
        2.虚拟机栈和线程，栈帧的模型图
![虚拟机栈-线程-栈帧](https://raw.githubusercontent.com/null23/picture/master/JVM/%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%E5%92%8C%E6%A0%88%E5%B8%A7.png)
        (一个线程创建一个虚拟机栈，每个栈由一个一个栈帧组成，每个方法的调用就创建一个栈帧并且压入栈，执行结束就弹出)
        3.若栈帧压入的深度(方法调用的次数)过多，超过[整个]虚拟机栈的[一个完整的栈帧]允许的深度，就会抛出StackOverflowError异常，意味着栈溢出。
        JVM会为每个线程的虚拟机栈分配一定的内存大小（-Xss参数），因此虚拟机栈能够容纳的栈帧数量是有限的，若栈帧不断进栈而不出栈，最终会导致当前线程虚拟机栈的内存空间耗尽，典型如一个无结束条件的递归函数调用。
        4.若同时运行的线程的个数过多，超过[整个]虚拟机栈允许的个数(是否可以理解为广度?也就是完整栈帧的个数)，就会抛出OutOfMemoryError:unable to create new native thread 异常，意味着整个虚拟机栈内存耗尽。

    本地方法栈：
        服务于Native方法。
        本地方法栈的功能和特点类似于虚拟机栈，均具有线程隔离的特点以及都能抛出StackOverflowError和OutOfMemoryError异常。
        不同的是，本地方法栈服务的对象是JVM执行的native方法，而虚拟机栈服务的是JVM执行的java方法。如何去服务native方法？native方法使用什么语言实现？怎么组织像栈帧这种为了服务方法的数据结构？虚拟机规范并未给出强制规定，因此不同的虚拟机实可以进行自由实现，我们常用的HotSpot虚拟机选择合并了虚拟机栈和本地方法栈。


堆内存和堆外内存：
    堆外内存：
        线程不在堆内存上创建，线程在堆内存之外的内存上创建。
        OOM-unable to create new native thread这种异常，就是堆外内存不够时产生的，不停的创建线程就会导致这种情况的发生。

        出现了堆外内存溢出的情况，如何解决？
        1.先看代码逻辑，为什么会不断创建线程？
        2.查看操作系统每个进程的最大线程数：使用ulimit -u命令查看操作系统对于每个进程创建的线程个数的限制，如果太小了就修改下操作系统线程数阈值
        3.减少堆内存：系统总内存6G，堆内存分配了5G，永久代512M。在这种情况下，JVM占用了5.5G内存，系统进程、其他用户进程和线程将共用剩下的0.5G内存，很有可能没有足够的可用内存创建新的线程。如果是这种情况，考虑减小堆内存。(系统总内存固定，但是Java进程占用的内存不固定，只是最大值时6G)
        4.减少进程数：这和减小堆内存原理相似。考虑如下场景：系统总内存32G，java进程数5个，每个进程的堆内存6G。在这种情况下，java进程总共占用30G内存，仅剩下2G内存用于系统进程、其他用户进程和线程，很有可能没有足够的可用内存创建新的线程。如果是这种情况，考虑减少每台机器上的进程数。
        5.减小线程栈大小：线程会占用内存，如果每个线程都占用更多内存，整体上将消耗更多的内存。每个线程默认占用内存大小取决于JVM实现。可以利用-Xss参数限制线程内存大小，降低总内存消耗。例如，JVM默认每个线程占用1M内存，应用有500个线程，那么将消耗500M内存空间。如果实际上256K内存足够线程正常运行，配置-Xss256k，那么500个线程将只需要消耗125M内存。（注意，如果-Xss设置的过低，将会产生java.lang.StackOverflowError错误）